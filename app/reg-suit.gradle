android.applicationVariants.all { variant ->
    def variantName = variant.name.capitalize()
    def realVariantName = variant.name

    if (variant.buildType.name != "debug") {
        return
    }

    task("execute${variantName}RegSuit") {
        group = "visual regression testing"
        description = "Execute reg-suit for ${realVariantName}"

        dependsOn "connected${variantName}AndroidTest"
        dependsOn "pullLocalScreenshots"
        dependsOn "clearLocalScreenshots"
        dependsOn "run${variantName}RegSuit"
    }

    task("clearLocalScreenshots", type: Exec) {
        group = "visual regression testing"
        description = "Clear local screenshots"
        commandLine android.adbExecutable, 'shell', 'rm', '-r', '/sdcard/screenshots'
    }

    task("pullLocalScreenshots", type: Exec) {
        group = "visual regression testing"
        description = "Pull local screenshots"
        commandLine android.adbExecutable, 'pull', '/sdcard/screenshots'
    }

    task("run${variantName}RegSuit", type: Exec) {
        group = "visual regression testing"
        description = "Run reg-suit for ${realVariantName}"
        commandLine 'reg-suit', 'run'
    }
}